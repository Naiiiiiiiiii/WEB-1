<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Admin - ShoeStore</title>
    <link rel="stylesheet" href="./css/admin-base.css">
    <link rel="stylesheet" href="./css/admin-product.css">
    <link rel="stylesheet" href="./css/admin-inventory.css">
    <link rel="stylesheet" href="./css/category-admin.css">
    <!-- ĐÃ GỠ: <link rel="stylesheet" href="./css/admin-import.css"> -->
    <link rel="stylesheet" href="./css/admin-price.css">
    <link rel="stylesheet" href="./css/admin-order.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" type="image/png" href="/favicon.png">
</head>

<body>
    <div id="loginPage">
        <form class="form_login" id="formDangNhap">
            <h1>Đăng nhập Admin</h1>
            <label>Username</label>
            <input type="text" id="username" placeholder="admin">

            <label>Password</label>
            <input type="password" id="password" placeholder="Admin123">

            <button type="submit">Login</button>
        </form>
    </div>

    <div id="adminPanel" style="display: none">

        <div class="menu">
            <div class="nav-container">
                <div class="logo"><i class="fa-solid fa-shoe-prints"></i> ShoeStore</div>

                <nav class="nav-menu">
                    <ul>
                        <li><a href="#index"><i class="fa-solid fa-house"></i> Trang chủ</a></li>
                        <li><a href="#user"><i class="fa-solid fa-users"></i> Quản lý tài khoản</a></li>
                        <li><a href="#products"><i class="fa-solid fa-box"></i> Quản lý sản phẩm</a></li>
                        <li><a href="#categories"><i class="fa-solid fa-tags"></i> Quản lý danh mục</a></li>
                        <li><a href="#orders"><i class="fa-solid fa-cart-shopping"></i> Quản lý đơn đặt hàng</a></li>
                        <li><a href="#inventory"><i class="fa-solid fa-warehouse"></i> Quản lý tồn kho</a></li>
                        <li><a href="#price"><i class="fa-solid fa-dollar-sign"></i> Quản lý Giá bán</a></li>
                        <!-- ĐÃ GỠ: <li><a href="#import-slips"><i class="fa-solid fa-file-import"></i> Quản lý Phiếu nhập</a></li> -->
                    </ul>
                </nav>
            </div>
        </div>

        <div class="main-content">

            <div class="header">
                <span>Chào, <b>ADMIN</b></span>
                <a href="" class="logout">Đăng xuất</a>
            </div>

            <section class="index" id="index">
                <div class="index-content">
                    <div class="index-content1">
                        <div class="index-content" id="countAccount">Số tài khoản hiện có:</div>
                        <div class="index-content" id="countProducts">Số sản phẩm hiện có:</div>
                    </div>
                    <div class="index-content2">
                        <div class="index-content" id="countOrders">Số đơn đặt hàng hiện có:</div>
                    </div>
                </div>
            </section>

            <section class="user" id="user">
                <h2>Quản lý tài khoản người dùng</h2>
                <div class="userTable-container">
                    <table class="userTable" id="userTable">
                        <thead>
                            <tr>
                                <th><i class="fa-solid fa-user"></i> Họ tên</th>
                                <th><i class="fa-solid fa-signature"></i> Tên đăng nhập</th>
                                <th><i class="fa-solid fa-envelope"></i> Email</th>
                                <th class="col-orders"><i class="fa-solid fa-bag-shopping"></i> Đơn hàng</th>
                                <th class="col-status"><i class="fa-solid fa-circle-info"></i> Trạng thái</th>
                                <th class="col-actions-lg"><i class="fa-solid fa-gear"></i> Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="products" id="products">
                <h2>Quản lý Sản phẩm</h2>

                <div class="section-toolbar">
                    <button id="addProductBtn" class="btn btn-primary">
                        <i class="fa-solid fa-plus"></i>
                        Thêm Sản phẩm Mới
                    </button>
                </div>

                <h3 class="mt-40">Danh sách Sản phẩm</h3>
                <table class="userTable">
                    <thead>
                        <tr>
                            <th class="col-id"><i class="fa-solid fa-barcode"></i> ID</th>
                            <th><i class="fa-solid fa-tag"></i> Tên Sản phẩm</th>
                            <th class="col-category"><i class="fa-solid fa-tags"></i> Danh mục</th>
                            <th class="col-price center"><i class=" fa-solid fa-dollar-sign"></i> Giá</th>
                            <th class="col-stock center"><i class="fa-solid fa-warehouse"></i> Tồn kho</th>
                            <th class="col-status"><i class="fa-solid fa-circle-info"></i> Trạng thái</th>
                            <th class="col-actions-md"><i class="fa-solid fa-gear"></i> Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBody"></tbody>
                </table>
            </section>

            <section class="products-category" id="categories">
                <h2>Quản lý Danh mục Sản phẩm</h2>

                <div class="section-toolbar">
                    <form id="addCategoryForm" class="actions">
                        <div class="field">
                            <label for="newCategoryName">Thêm Loại Sản phẩm mới</label>
                            <input type="text" id="newCategoryName" placeholder="Tên loại (vd: Giày Sandal)" required
                                minlength="2" maxlength="50">
                            <small class="input-hint">Tối thiểu 2 ký tự, tối đa 50 ký tự</small>
                        </div>
                        <button type="submit" class="btn primary">Thêm</button>
                    </form>
                </div>

                <table class="data-table category-table">z
                    <thead>
                        <tr>
                            <th><i class="fa-solid fa-barcode"></i> ID</th>
                            <th><i class="fa-solid fa-tag"></i> Tên loại</th>
                            <th class="col-status"><i class="fa-solid fa-circle-info"></i> Trạng thái</th>
                            <th class="col-actions-sm"><i class="fa-solid fa-gear"></i> Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="categoryTableBody">
                    </tbody>
                </table>
            </section>

            <section class="orders" id="orders">
                <h2>Quản lý đơn đặt hàng</h2>
                <div class="section-toolbar">
                    <div class="field">
                        <label for="orderFilterFrom">Từ ngày</label>
                        <input type="date" id="orderFilterFrom">
                    </div>
                    <div class="field">
                        <label for="orderFilterTo">Đến ngày</label>
                        <input type="date" id="orderFilterTo">
                    </div>
                    <div class="field">
                        <label for="orderFilterStatus">Trạng thái</label>
                        <select id="orderFilterStatus" class="w-160">
                            <option value="all">Tất cả</option>
                            <option value="new">Đang chờ xử lý</option>
                            <option value="processed">Đã xử lý</option>
                            <option value="delivered">Đã giao</option>
                            <option value="canceled">Đã hủy</option>
                        </select>
                    </div>
                    <div class="field">
                        <button class="btn primary" id="orderFilterApply">
                            <i class="fa-solid fa-filter"></i> Lọc
                        </button>
                    </div>
                    <div class="field">
                        <button class="btn" id="orderFilterReset">
                            <i class="fa-solid fa-rotate-right"></i> Đặt lại
                        </button>
                    </div>
                </div>

                <table id="ordersTable">
                    <thead>
                        <tr>
                            <th class="col-slip-num"><i class="fa-solid fa-receipt"></i> Mã đơn</th>
                            <th class="col-date"><i class="fa-solid fa-calendar-days"></i> Ngày đặt</th>
                            <th><i class="fa-solid fa-user"></i> Khách hàng</th>
                            <th class="col-price right"><i class="fa-solid fa-money-bill-wave"></i> Tổng tiền</th>
                            <th class="col-status-lg"><i class="fa-solid fa-circle-info"></i> Trạng thái</th>
                            <th class="col-actions"><i class="fa-solid fa-gear"></i> Hành động</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 20px;">
                                <i class="fa-solid fa-spinner fa-spin"></i> Đang tải đơn hàng...
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="pagination" id="ordersPagination"></div>

                <div class="panel" id="orderDetailBox" style="display:none">
                    <div class="grid-2" style="align-items: center;">
                        <div>
                            <h3><i class="fa-solid fa-file-invoice-dollar"></i> Chi tiết đơn hàng</h3>
                        </div>
                        <div class="right">
                            <button class="btn" id="orderDetailClose">
                                <i class="fa-solid fa-xmark"></i> Đóng
                            </button>
                        </div>
                    </div>

                    <div class="order-detail-grid">
                        <div class="detail-section">
                            <h4><i class="fa-solid fa-user"></i> Thông tin Khách hàng & Giao hàng</h4>
                            <div id="orderDetailMeta" class="muted">
                            </div>
                        </div>

                        <div class="detail-section">
                            <h4><i class="fa-solid fa-boxes-stacked"></i> Danh sách Sản phẩm</h4>
                            <div id="orderDetailItems">
                            </div>

                            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">

                            <h4><i class="fa-solid fa-truck-fast"></i> Cập nhật Trạng thái</h4>
                            <form id="orderStatusUpdateForm">
                                <div class="field" style="display: flex; align-items: center; gap: 15px;">
                                    <label for="orderStatusUpdateSelect">Chọn trạng thái mới:</label>
                                    <select id="orderStatusUpdateSelect">
                                        <option value="Đang chờ xử lý">Đang chờ xử lý</option>
                                        <option value="Đã xử lý">Đã xử lý</option>
                                        <option value="Đã giao">Đã giao</option>
                                        <option value="Đã hủy">Đã hủy (Hoàn tồn kho)</option>
                                    </select>
                                    <button type="submit" class="btn primary" id="orderStatusUpdateBtn">
                                        <i class="fa-solid fa-check"></i> Cập nhật
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

            <section class="inventory" id="inventory">
                <h2>Quản lý Tồn kho</h2>

                <!-- ĐÃ GỠ: Khối "Thêm Phiếu Nhập Hàng" -->
                <!-- Giữ lại toolbar lọc tồn kho -->
                <h3 class="mt-40">Bảng Tổng hợp Tồn kho</h3>

                <div class="section-toolbar">
                    <div class="field">
                        <label for="invFilterCategory">Phân loại</label>
                        <select id="invFilterCategory" class="w-160">
                            <option value="all">Tất cả</option>
                        </select>
                    </div>
                    <div class="field">
                        <label for="invFilterName">Tên sản phẩm</label>
                        <input type="text" id="invFilterName" placeholder="Nhập tên sản phẩm...">
                    </div>
                    <div class="field">
                        <button class="btn primary" id="invFilterApply">Tra cứu</button>
                    </div>
                    <div class="field">
                        <button class="btn" id="invFilterReset">Đặt lại</button>
                    </div>
                </div>

                <table id="inventoryTable">
                    <thead>
                        <tr>
                            <th class="col-id"><i class="fa-solid fa-barcode"></i> Mã SP</th>
                            <th><i class="fa-solid fa-tag"></i> Tên</th>
                            <th class="col-category"><i class="fa-solid fa-tags"></i> Loại</th>
                            <th class="col-stock right"><i class="fa-solid fa-warehouse"></i> Tồn</th>
                            <th class="col-price right"><i class="fa-solid fa-dollar-sign"></i> Giá Vốn</th>
                            <th class="col-status"><i class="fa-solid fa-circle-info"></i> Trạng thái</th>
                            <th class="col-actions"><i class="fa-solid fa-gear"></i> Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTableBody"></tbody>
                </table>

                <div id="stockMovementModal" class="modal">
                    <div class="modal-content">

                        <div class="modal-header">
                            <h5 id="movementProductName">Lịch sử Nhập/Xuất/Tồn</h5>
                            <span class="close-btn" id="closeMovementModal">&times;</span>
                        </div>

                        <div class="modal-body">

                            <form id="movementFilterForm" class="filter-form">
                                <div class="input-group">
                                    <label for="movementStartDate">Từ ngày:</label>
                                    <input type="date" id="movementStartDate" required>
                                </div>
                                <div class="input-group">
                                    <label for="movementEndDate">Đến ngày:</label>
                                    <input type="date" id="movementEndDate" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Xem báo cáo</button>
                            </form>

                            <div class="summary-container mt-20">
                                <div class="summary-box start">
                                    <div class="label">Tồn Đầu Kỳ</div>
                                    <div class="value" id="summaryStartStock">0</div>
                                </div>
                                <div class="summary-box in">
                                    <div class="label">Tổng Nhập</div>
                                    <div class="value" id="summaryTotalIn">0</div>
                                </div>
                                <div class="summary-box out">
                                    <div class="label">Tổng Xuất</div>
                                    <div class="value" id="summaryTotalOut">0</div>
                                </div>
                                <div class="summary-box end">
                                    <div class="label">Tồn Cuối Kỳ</div>
                                    <div class="value" id="summaryEndStock">0</div>
                                </div>
                            </div>

                            <h4 class="mt-40">Chi tiết Giao dịch (Nhập/Xuất)</h4>
                            <table class="userTable mt-10">
                                <thead>
                                    <tr>
                                        <th class="col-date">Ngày</th>
                                        <th class="col-slip-type">Loại</th>
                                        <th class="col-qty right">Số lượng</th>
                                        <th>Ghi chú/Mã đơn hàng</th>
                                        <th class="col-price right">Giá Vốn</th>
                                    </tr>
                                </thead>
                                <tbody id="movementLogTableBody">
                                    <tr>
                                        <td colspan="5" class="center">Vui lòng chọn khoảng thời gian để xem chi tiết.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="modal-footer">
                            <button class="btn btn-secondary" id="closeMovementModalFooter">Đóng</button>
                        </div>

                    </div>
                </div>

            </section>

            <section class="price" id="price">
                <h2><i class="fa-solid fa-dollar-sign"></i> Quản lý Giá bán & Lợi nhuận</h2>
                <p class="description">
                    Sử dụng công cụ này để thiết lập giá bán tự động dựa trên <strong>Giá Vốn</strong> và <strong>Tỉ lệ
                        Lợi nhuận (Margin)</strong> mong muốn.
                    <br>
                    Công thức: <code>Giá Bán = Giá Vốn / (1 - (Tỉ lệ Lợi nhuận % / 100))</code>
                </p>

                <h3 class="mt-40">Bộ lọc & Tra cứu</h3>
                <div class="section-toolbar filter-toolbar">
                    <div class="field">
                        <label for="priceFilterCategory">
                            <i class="fa-solid fa-tags"></i> Phân loại
                        </label>
                        <select id="priceFilterCategory" class="w-160">
                            <option value="all">Tất cả</option>
                        </select>
                    </div>
                    <div class="field">
                        <label for="priceFilterName">
                            <i class="fa-solid fa-search"></i> Tên sản phẩm
                        </label>
                        <input type="text" id="priceFilterName" placeholder="Nhập tên sản phẩm...">
                    </div>
                    <div class="field">
                        <button class="btn primary" id="priceFilterApply">
                            <i class="fa-solid fa-magnifying-glass"></i> Lọc
                        </button>
                    </div>
                    <div class="field">
                        <button class="btn" id="priceFilterReset">
                            <i class="fa-solid fa-rotate-right"></i> Đặt lại
                        </button>
                    </div>
                </div>

                <h3 class="mt-40">Bảng Tra cứu & Cập nhật Giá</h3>
                <div class="table-responsive">
                    <table class="userTable price-table">
                        <thead>
                            <tr>
                                <th class="col-id"><i class="fa-solid fa-barcode"></i> Mã SP</th>
                                <th><i class="fa-solid fa-tag"></i> Tên Sản phẩm</th>
                                <th class="col-category"><i class="fa-solid fa-tags"></i> Danh mục</th>
                                <th class="col-price right"><i class="fa-solid fa-dollar-sign"></i> Giá Vốn</th>
                                <th class="col-price right"><i class="fa-solid fa-sack-dollar"></i> Giá Bán (Hiện tại)
                                </th>
                                <th class="col-margin right"><i class="fa-solid fa-percent"></i> Lợi nhuận (Thực tế)
                                </th>
                                <th class="col-margin-input center"><i class="fa-solid fa-calculator"></i> Thiết lập Lợi
                                    nhuận (%)</th>
                                <th class="col-actions"><i class="fa-solid fa-gear"></i> Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="priceTableBody">
                            <tr>
                                <td colspan="8" class="center">
                                    <div class="loading-placeholder">
                                        <i class="fa-solid fa-spinner fa-spin"></i> Đang tải dữ liệu...
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

        </div>
    </div>

    <div id="productModal" class="product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">➕ Thêm Sản phẩm Mới</h3>
                <button class="close-modal-btn" type="button">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <div class="modal-body">
                <form id="productModalForm" class="modal-form">
                    <div class="form-group">
                        <label for="modalProductName">
                            Tên Sản phẩm
                            <span class="required">*</span>
                        </label>
                        <input type="text" id="modalProductName" placeholder="VD: Giày thể thao Nike Air Max" required>
                        <small>Tối thiểu 3 ký tự</small>
                    </div>

                    <div class="form-group">
                        <label for="modalProductCategory">
                            Danh mục
                            <span class="required">*</span>
                        </label>
                        <select id="modalProductCategory" required>
                            <option value="">-- Chọn Danh mục --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="modalProductPrice">
                            Giá bán (VNĐ)
                            <span class="required">*</span>
                        </label>
                        <input type="number" id="modalProductPrice" placeholder="VD: 2500000" min="1000" step="1000"
                            required>
                        <small>Giá phải lớn hơn 0</small>
                    </div>

                    <div class="form-group">
                        <label for="modalProductImage">
                            URL Hình ảnh
                            <span class="required">*</span>
                        </label>
                        <input type="text" id="modalProductImage" placeholder="Ví dụ: img/ten_giay.jpg" required>
                        <small>Link hình ảnh từ internet hoặc thư mục dự án</small>

                        <div id="imagePreview" class="image-preview-container">
                            <img id="previewImg" src="" alt="Preview">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="modalProductDescription">
                            Mô tả Sản phẩm
                            <span class="required">*</span>
                        </label>
                        <textarea id="modalProductDescription" placeholder="Nhập mô tả chi tiết về sản phẩm..."
                            required></textarea>
                        <small>Mô tả chi tiết giúp khách hàng hiểu rõ hơn</small>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn-secondary cancel-modal-btn">
                    <i class="fa-solid fa-xmark"></i>
                    Hủy
                </button>
                <button type="submit" form="productModalForm" class="btn-primary">
                    <i class="fa-solid fa-check"></i>
                    Lưu Sản phẩm
                </button>
            </div>
        </div>
    </div>

    <!-- ĐÃ GỠ: Modal chỉnh sửa Phiếu Nhập (editImportSlipModal) -->

    <!-- Modal chi tiết biến thể tồn kho -->
    <div id="variantStockModal" class="modal" style="display:none">
        <div class="modal-content" style="max-width:700px">
            <div class="modal-header" style="display:flex;justify-content:space-between;align-items:center;">
                <h5 id="variantModalTitle">Chi tiết tồn kho</h5>
                <button id="variantModalClose" class="btn" style="min-width:60px">Đóng</button>
            </div>
            <div class="modal-body" id="variantModalBody">
                <!-- Nội dung động -->
            </div>
        </div>
    </div>

    <script type="module" src="./js/user.js"></script>
    <script type="module" src="./js/category.js"></script>
    <script type="module" src="./js/Product.js"></script>
    <script type="module" src="./js/ProductManager.js"></script>
    <script type="module" src="./js/order-manager.js"></script>
    <!-- ĐÃ GỠ: <script type="module" src="./js/ImportSlip.js"></script> -->
    <script type="module" src="./js/admin.js"></script>
    <script type="module" src="./js/category-admin.js"></script>
    <script type="module" src="./js/product-admin.js"></script>
    <script type="module" src="./js/order-admin.js"></script>
    <!-- ĐÃ GỠ: <script type="module" src="./js/import-admin.js"></script> -->
    <script type="module" src="./js/price-admin.js"></script>
    <!-- THÊM MỚI: Quản lý tồn kho + ngưỡng cảnh báo -->
    <script type="module" src="./js/ThresholdManager.js"></script>
    <script type="module" src="./js/inventory-admin.js"></script>

</body>

</html>